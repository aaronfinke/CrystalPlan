
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title></title>
<meta name="generator" content="Bluefish 1.0.7"/>
<meta name="author" content="Janik Zikovsky"/>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8"/>
<meta http-equiv="content-style-type" content="text/css" />
</head>

<style type="text/css">
	.break { page-break-before: always; }

img {
	vertical-align:middle;
	}
IMG.frameshot 
	{
	display: block;
	margin-left: auto;
   margin-right: auto;
   padding-top: 15px;
   padding-bottom: 15px;
   }
dt {
	display: list-item;
	font-weight:bold;
	padding-bottom: 3px;
	}
h2 {
	font-size:26pt;
	border-top:medium solid #000000;
	}
h3 {
	font-size:20pt;
	border-top:thin solid #000000;
	padding-top:5px;
	}
h4 {
	font-size:16pt;
	border-top:thin dashed #000000;
	padding-top:5px;
	}
li {
	padding-top:3px;
	}
ul {
	padding-bottom: 5px;
	}
</style>


<body bgcolor="white">
<!-- Crystal Plan User Guide -->

<h1>CrystalPlan 1.0 User Guide</h1>
by Janik Zikovsky (zikovskyjl@ornl.gov)<br/>
written April 14th, 2010.

<h3>Introduction</h3>

<p>CrystalPlan is an experiment planning tool for crystallography; CrystalPlan...
</p>
<ul>
<li>Lets you put in a list of sample orientation angles, and...</li>
<li>...calculates the coverage of detectors in reciprocal space.</li>
<li>When you give it your sample's lattice parameters and UB matrix, it...</li>
<li>...predicts the positions of single-crystal peaks.</li>
<li>You can then optimize your experiment by trying different orientations and seeing if your coverage statistics will still be adequate.</li>
</ul>

<!-- ========================================================= -->
<!-- ========================================================= -->
<!-- ========================================================= -->

<h2>Step-by-Step Tutorial</h2>

<p>This tutorial will show you how to use most of the features of CrystalPlan by going through a typical run, step-by-step.</p>


<!-- ========================================================= -->

<h3>1. Starting CrystalPlan</h3>

<p>From the terminal command line, type:
<div align="center"><font face="Courier">crystalplan.py</font></div>
The GUI launches in two new windows. Select the main window:
</p>
<br/>
<img class="frameshot" src="screenshots/frame_main.png" width="400" border="0" alt="The main CrystalPlan GUI window."/><br/>
<br/>
Most of your workflow will occur by navigating between these notebook tabs:
<br/><img src="screenshots/frame_main-tab_anim.png" border="0"/>

<!-- ========================================================= -->

<h3>2. Defining the Reciprocal Space of Interest and Wavelengths</h3>

<p>Here you will set the general parameters of your experiment.</p>

<ul>
<li>Click the "Q-Space" tab, if it not already selected. If necessary, change the parameters so that it matches those shown below:
<br/><img src="screenshots/startup-traits.png" border="0" alt=""/>
</li>
<ul>
	<dt>d_min</dt>
	<dd>The smallest d-spacing allowed. Your simulated q-space will be limited to a maximum <span class="eq">$q = {2\pi}/d_{min}$</span></dd>
	
	<dt>q-resolution</dt>
	<dd>The size of a voxel (smallest volume element) simulated, in <span class="eq">$\AA^{-1}$</span>. The # of points will be calculated and shown below; you will get a warning if you try to make very high-resolution calculations, because memory consumption, etc. will be very high.</dd>
	
	<dt>wavelength limits</dt>
	<dd>Specify your experiment's wavelength limits, in Ansgtroms; this could be due to limits on your neutron source or your detectors.</dd>
</ul>

<li>When done, click the 
<img src="screenshots/startup-apply.png" border="0" alt="Apply Changes"/>
button. Changing these settings requires re-doing a lot of calculations, which may take some time if you have a lot of orientations saved. 
</li>
</ul>


<!-- ========================================================= -->

<h3>3. Detectors</h3>

Here, you ensure that CrystalPlan has the correct detector geometry loaded.

<ul>
<li>Click the "Detectors" tab.</li>

<li>Load a detector geometry by clicking the
<img src="screenshots/detectors-buttonLoadDetectors.png" border="0" alt=""/> button. In the File Loading dialog that opens, select the "TOPAZ_detectors_all.csv" file.
</li>
<li>After a few seconds, the detector geometry is loaded. To confirm that the detectors are in the correct positions, you can visualize them in direct space by clicking 
<img src="screenshots/detectors-button_view_detectors.png" border="0" alt=""/>, 
which displays them in a window like this one:
<br/><img class="frameshot" src="screenshots/detectors-3d_view.png" border="0" alt=""/>
</li>
<li>We will come back later to the other controls on this tab.</li>
</ul>


<!-- ========================================================= -->

<h3>4. Goniometer</h3>


Now, you want to make sure that CrystalPlan is aware of which goniometer is currently in
use in your instrument.

<ul>
<li>Click the "Goniometer" tab. The goniometer that is currently selected is shown at the top:
<img src="screenshots/goniometer-selected.png" border="0" alt=""/>
</li>
<li> Select the TOPAZ in-house goniometer:
<br/><img src="screenshots/goniometer-choice.png" border="0" alt=""/>
</li>
<li>Some general information about the goniometer is shown:
<br/><img src="screenshots/goniometer-desc.png" border="0" alt=""/>
</li>
<li>But your selection is not complete until you click 
<img src="screenshots/goniometer-buttonSwitchGoniometer.png" border="0" alt=""/>
</li>
<li>The program will now be aware of the sample orientation angle limitations that your instrument has, and will give you warnings if you try to use an inaccessible sample orientation.</li>
</ul>

<!-- ========================================================= -->

<h3>5. Sample Settings</h3>

Now, you will want to enter or load in information about your sample: crystal lattice parameters, UB matrix, etc.

<ul>
<li>Click the "Sample" tab. You are presented with an overview of the crystal parameters
<br/><img src="screenshots/sample-info.png" border="0" alt=""/>
</li>

<h4>5.1. Edit Crystal Parameters dialog</h3>

<li>Click
<img src="screenshots/sample-buttonEditCrystal.png" border="0" alt=""/>. 
</li>
<ul>
<li>This brings up the "Edit Crystal Parameters" dialog box. You may edit the name and description:
<br/><img class="frameshot" src="screenshots/dialog_edit_crystal.png" border="0" alt=""/></li>
<li>The top of the dialog shows you the current crystal parameters.</li>
<br/>
<li>The "Manually Enter Lattice" tab allows you to try out the program by typing in
your lattice parameters and the sample mounting. 
<br/><img src="screenshots/dialog_edit_crystal-notebook1.png" border="0" alt=""/></li>
</li>
<ul>
<li>Clicking the 
<img src="screenshots/dialog_edit_crystal-buttonGenerateUB.png" border="0" alt=""/> button creates a UB matrix that you can use to test features of the program; however we will not be doing that in this tutorial.</li>
</ul>
<br/>
<li>Instead, go to the "Load from ISAW" tab:
<br/><img src="screenshots/dialog_edit_crystal-notebook0.png" border="0" alt=""/> 
</li>
<li>ISAW can generate a UB matrix file that contains:</li>
<ul> 
<li>The crystal's <i>measured</i> UB matrix - this contains information about how the crystal is mounted relative to </li>
<li>The crystal's lattice lengths and angles. </li>
</ul>
<li>To learn how to calculate a UB matrix, please refer to ISAW's documentation. Using ISAW, you will be using the Initial Peaks wizard to locate and index the peaks. This method can be used to find both the lattice parameters and UB matrix, or you can specify the lattice parameters if known.</li>
<li>You can also generate the same file using ISAWev (the ISAW event viewer), working directly from event data in reciprocal space. The procedure is the same (find and index the peaks) though the interface is a little different. Both methods generate exactly the same file format.</li>
<li><font size="+1">However, the UB matrix output by ISAW <b>includes the orientation due to the goniometer</b> and not just the crystal mounting orientation.</font>
</li>
<ul>
<li>The UB matrix needs to be corrected to account for this extra rotation.</li>
<li>This requires you to enter the goniometer angles corresponding to the sample orientation in the UB matrix file to load - the goniometer settings at the time that data was acquired.
</li>
<li>Enter these angles, in degrees, here:
<img src="screenshots/dialog_edit_crystal-control_load_angles.png"/>
</li>
</ul>
<li>A sample UB matrix file can be found in the "model/data/quartzub.txt" file. Click the 
<img src="screenshots/dialog_edit_crystal-buttonReadUB.png"/>
button and select this file in the dialog.
</li>
<li>The top of the dialog shows you the loaded lattice parameters and UB matrix.
<br/><img src="screenshots/dialog_edit_crystal-control_top.png"/>
</li>
<li>From here, you can set the crystal's point group symmetry; however, we will leave it as "-1 (Triclinic)", as shown.</li>
<li>Click
<img src="screenshots/dialog_edit_crystal-buttonOK.png"/> 
to apply the changes; clicking 
<img src="screenshots/dialog_edit_crystal-buttonCancel.png"/>
would revert all the changed made in the dialog. 
</li>
<li>Some recalculations will occur when changing the crystal lattice parameters or orientation.</li>
</ul>

<h4>5.2. Choosing H,K,L ranges</h3>

<li>Still in the Sample tab, the following GUI allows you to pick which HKL to display:
<br/><img src="screenshots/sample-range_control.png"/>
</li>
<li>These H,K,L ranges limit which peak indices that CrystalPlan will calculate and display.
</li>
<li>You can type in your ranges manually, however, I recommend that you keep both checkboxes checked:</li>
<ul>
<li>They use the <i>d_min</i> parameter you set earlier in the "Q-Space" tab. </li>
<li>The first calculates the H,K,L ranges that fill a box of side in q-space corresponding to <i>d_min</i>. </li>
<li>The resulting peaks will form a cube only if all the lattice angles are 90 degrees.</li>
<li>By checking the second box, any peaks with a d-spacing smaller that <i>d_min</i> will be rejected, leaving a sphere of reflections in q-space.</li>
</ul>
<li>Click the <img src="screenshots/sample-buttonApplyRange.png"/> button to apply 
any changes you have made. All reflections are re-calculated.
</li>


</ul>
<!-- ========================================================= -->

<h3>6. Adding Sample Orientations</h3>
<ul>
<li>
Click the "Start" button to begin the calculation. 
<br/><img src="screenshots/add_positions-start_button.png" border="0" alt=""/>
</li>

<li>The calculation progress will be shown in this progress bar: <br/>
<img src="screenshots/add_positions-progress_bar.png" border="0" alt=""/> <br/></li>

<li>If the calculation runs too long, you can cancel it before it completes. Sample orientations that have already been calculated will remain in the experiment plan.<br/>
<img src="screenshots/add_positions-cancel_button.png" border="0" alt=""/></li>

</ul>

</body>
</html>